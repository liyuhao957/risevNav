# Context
Created: [12:30:45]

## Original Prompt
需要将两个独立的Python监控脚本改造为Web服务并集成到现有项目中：
1. huaweiSM.py - 监控快应用版本说明更新（每5分钟检测一次）
2. huaweiJZQ.py - 监控快应用加载器更新（每5分钟检测一次）
这两个脚本目前通过飞书机器人通知变化。同时需要将整个项目迁移到服务器上。

## Project Overview
项目整体改造和迁移涉及：
1. 监控脚本改造
   - 保持原有Python脚本核心逻辑不变
   - 添加JSON文件输出功能
   - 定时运行并更新数据
2. 后端集成
   - 创建独立的Node.js后端服务
   - 读取监控脚本生成的JSON文件
   - 提供监控数据的API
3. 前端开发
   - 创建独立的Vue监控页面项目
   - 展示监控数据和历史记录
4. 分阶段部署
   - 第一阶段：本地开发环境搭建和测试
   - 第二阶段：服务器环境准备和部署

## Issues and Progress Below
-----------------------------------
# ISSUE #1: 项目集成设计
-----------------------------------

## Analysis
1. 项目目录结构：
```
risevNav/                 # 项目根目录
├── src/                  # 现有前端（保持不变）
├── server/               # 现有后端（保持不变）
├── monitor-frontend/     # 新增：监控系统前端
│   ├── src/
│   │   ├── views/       # 页面组件
│   │   ├── components/  # 通用组件
│   │   ├── services/    # API服务
│   │   └── assets/      # 静态资源
│   └── package.json
├── monitor-server/       # 新增：监控系统后端
│   ├── src/
│   │   ├── routes/      # API路由
│   │   └── services/    # 业务逻辑
│   ├── data/            # JSON数据存储
│   │   ├── version_updates.json
│   │   └── loader_updates.json
│   └── package.json
├── scripts/             # 新增：监控脚本
│   ├── huaweiSM.py     # 版本说明监控
│   └── huaweiJZQ.py    # 加载器监控
└── [其他项目文件]
```

2. 数据流转逻辑：
   - Python脚本定时运行并更新JSON文件
   - 独立的Node.js后端读取JSON文件并提供API
   - 独立的Vue前端通过API获取数据并展示

## Implementation
- [ ] 步骤1: 本地开发环境准备
  - [ ] 1.1: 创建新的项目目录
    - [ ] 创建monitor-frontend目录
    - [ ] 创建monitor-server目录
    - [ ] 创建scripts目录
  - [ ] 1.2: 初始化前端项目
    - [ ] Vue 3项目初始化
    - [ ] 安装Element Plus
    - [ ] 安装axios
    - [ ] 配置开发环境
  - [ ] 1.3: 初始化后端项目
    - [ ] Express项目初始化
    - [ ] 配置开发环境
    - [ ] 创建必要目录

- [ ] 步骤2: 后端开发
  - [ ] 2.1: 添加监控相关路由
    - [ ] GET /api/monitor/version/latest
    - [ ] GET /api/monitor/version/history
    - [ ] GET /api/monitor/loader/latest
    - [ ] GET /api/monitor/loader/history
  - [ ] 2.2: 实现JSON文件读取功能
  - [ ] 2.3: 添加WebSocket支持(可选)
  - [ ] 2.4: 本地测试API接口

- [ ] 步骤3: 前端开发
  - [ ] 3.1: 创建页面组件
    - [ ] 版本监控页面
    - [ ] 加载器监控页面
    - [ ] 历史记录页面
  - [ ] 3.2: 实现数据展示
  - [ ] 3.3: 添加错误处理和加载状态
  - [ ] 3.4: 本地调试前后端联调

- [ ] 步骤4: 本地部署测试
  - [ ] 4.1: 配置本地开发环境
  - [ ] 4.2: 启动后端服务
  - [ ] 4.3: 启动前端服务
  - [ ] 4.4: 完整功能测试
  - [ ] 4.5: 修复本地运行问题

- [ ] 步骤5: 服务器部署（完成本地测试后进行）
  - [ ] 5.1: 初始部署
    - [ ] 创建Git仓库并提交代码
    - [ ] 在服务器上克隆仓库
    - [ ] 安装Node.js环境
    - [ ] 安装Python环境和依赖
    - [ ] 配置环境变量
  
  - [ ] 5.2: 服务配置
    - [ ] 配置Nginx反向代理（新增监控系统路由）
    - [ ] 设置PM2守护监控系统进程
    - [ ] 配置Python脚本的定时任务（crontab）
    - [ ] 配置日志记录
  
  - [ ] 5.3: 启动服务
    - [ ] 启动监控系统后端（PM2）
    - [ ] 启动监控系统前端
    - [ ] 启动Python监控脚本
    - [ ] 验证服务状态
  
  - [ ] 5.4: 更新流程测试
    - [ ] 本地修改代码
    - [ ] 提交到Git
    - [ ] 服务器拉取更新
    - [ ] 重启服务
    - [ ] 验证更新

## 部署文档
1. 初始部署步骤：
```bash
# 1. 在服务器上克隆代码
git clone [仓库地址]
cd [项目目录]

# 2. 安装依赖
cd monitor-frontend
npm install

cd ../monitor-server
npm install

cd ../scripts
pip install -r requirements.txt

# 3. 配置PM2
pm2 start monitor-server/src/app.js --name "monitor-backend"

# 4. 配置Python脚本守护进程
# 使用supervisor确保Python脚本持续运行
sudo apt-get install supervisor

# 创建supervisor配置文件
sudo vim /etc/supervisor/conf.d/huawei-monitor.conf

# 添加配置内容：
[program:huawei-sm]
command=python3 huaweiSM.py
directory=/path/to/scripts
autostart=true
autorestart=true
stderr_logfile=/var/log/huawei-sm.err.log
stdout_logfile=/var/log/huawei-sm.out.log

[program:huawei-jzq]
command=python3 huaweiJZQ.py
directory=/path/to/scripts
autostart=true
autorestart=true
stderr_logfile=/var/log/huawei-jzq.err.log
stdout_logfile=/var/log/huawei-jzq.out.log

# 更新supervisor
sudo supervisorctl reread
sudo supervisorctl update
```

2. 更新部署步骤（不中断服务）：
```bash
# 1. 登录服务器
ssh user@server

# 2. 进入项目目录
cd [项目目录]

# 3. 备份当前代码（以防需要回滚）
cp -r scripts scripts_backup

# 4. 拉取最新代码
git pull

# 5. 如果有依赖更新
cd monitor-frontend
npm install

cd ../monitor-server
npm install

cd ../scripts
pip install -r requirements.txt

# 6. 重启Node.js服务（使用PM2的reload避免停机）
pm2 reload monitor-backend

# 7. 重启Python监控脚本（一个一个更新，确保不会同时停止）
sudo supervisorctl restart huawei-sm
# 等待确认huawei-sm正常运行
sudo supervisorctl status huawei-sm
# 确认正常后再重启下一个
sudo supervisorctl restart huawei-jzq
```

3. 常用维护命令：
```bash
# 查看所有服务状态
sudo supervisorctl status
pm2 status

# 查看日志
sudo tail -f /var/log/huawei-sm.out.log
sudo tail -f /var/log/huawei-jzq.out.log
pm2 logs monitor-backend

# 如果需要回滚
cp -r scripts_backup/* scripts/
sudo supervisorctl restart huawei-sm huawei-jzq
```

4. 监控服务健康状态：
```bash
# 添加到crontab
* * * * * /path/to/check_services.sh

# check_services.sh 内容
#!/bin/bash
if ! pgrep -f "huaweiSM.py" > /dev/null; then
    sudo supervisorctl restart huawei-sm
fi
if ! pgrep -f "huaweiJZQ.py" > /dev/null; then
    sudo supervisorctl restart huawei-jzq
fi
```

## Status
- 当前状态：已完成项目集成方案设计
- 下一步：创建新的项目目录结构
- 阻塞项：无

## Implementation Steps
1. [x] 创建基础目录结构
   - [x] 创建monitor-frontend目录
   - [x] 创建monitor-server目录
   - [x] 创建scripts目录
2. [x] 初始化前端项目
   - [x] 初始化package.json
   - [x] 安装必要依赖
   - [ ] 配置开发环境
3. [x] 初始化后端项目
   - [x] 初始化package.json
   - [x] 安装必要依赖
   - [ ] 配置开发环境
   - [x] 创建必要目录
4. [x] 配置监控脚本
   - [x] 移动现有脚本到scripts目录
   - [ ] 添加配置文件
   - [ ] 测试脚本运行

# Progress
[12:30:45] 开始任务：分析需求
[12:35:00] 完成：原有脚本分析
[12:45:00] 完成：接口设计
[13:00:00] 完成：前端设计
[13:10:00] 完成：整体方案设计
[13:30:00] 更新：调整为独立项目结构
[13:45:00] 完成：项目结构设计
[14:30:00] 完成：基础目录结构创建
[14:45:00] 完成：前后端package.json初始化
[15:00:00] 完成：前后端依赖安装