# RisevNav 任务模板
> 这是一个用于追踪和管理 RisevNav 项目任务的标准模板

# 用户输入部分
[任务描述]: <在这里详细描述你的任务>
[项目概述]: <输入项目概述，或包含详细信息的文件链接>   
[主分支]: <你的主分支名称，默认 master>
[快速模式]: <ask|on|off> (ask: 询问是否启用, on: 启用, off: 禁用)

---

# 全局目标
1. 阅读底部的"用户输入"
2. 仔细阅读整个提示
3. 遵循"执行协议"
4. 在每个验证点停止以等待人工确认
5. 将任务文件作为中心真实来源

> 当你完全理解以上全局目标时，必须回复"我理解主要目标"，并提供：
> - 全局目标的总结
> - 逐步重复执行协议的内容
> - 如果[快速模式]设置为"ask"，询问用户是否要以"快速模式"继续

---

# 执行协议：

## 1. Git 分支创建
1. 从[主分支]创建新的任务分支：  
   ```
   git checkout -b task/[任务标识符]_[任务日期和编号]
   ```
2. 在[任务文件]中的"任务分支"下添加分支名称
3. 验证分支是否激活：  
   ```
   git branch --show-current
   ```

## 2. 任务分析
- 逐步检查[任务]、相关代码和功能

<<< 如果不是[快速模式]则暂停：等待用户确认你的分析是否完整，如果不完整，重复此步骤 >>>

## 3. 任务文件创建
1. 创建[任务文件]，命名为 `[任务文件名]_[任务标识符].md` 并将其放在项目根目录的 `.tasks` 目录中
2. 首先将"占位符定义"中的所有内容按原样添加到[任务文件]中
   - 这是为了确保其他开发人员知道这些占位符的含义
3. 然后使用以下内容填充整个"任务文件模板"：
   - 执行步骤 2 的结果
   - 用户提供的输入

<<< 如果不是[快速模式]则暂停：等待用户确认[任务文件]名称和内容 >>>

## 4. 迭代任务
1. 在更改前完整分析代码上下文
2. 分析[任务文件]中"任务进度"下的更新，确保不重复之前的错误或失败的更改
3. 根据需要对代码库进行更改
4. 在[任务文件]中的"任务进度"下更新任何进展
5. 对于每个更改：
   - 寻求用户对更新的确认
   - 在用户确认后在日志中标记更改为成功或失败
   - 可选，在适当时（由你决定）提交代码：
      ```
      git add --all -- ':!./.tasks'
      git commit -m "[提交消息]"
      ```

<<< 如果不是[快速模式]则暂停：继续之前，与用户确认更改是否成功，如果不成功，再次迭代此执行步骤 >>>

## 5. 任务完成
1. 在用户确认后，如果有要提交的更改：
   - 暂存除任务文件外的所有更改：
     ```
     git add --all -- ':!./.tasks'
     ```
   - 使用简洁的消息提交更改：
     ```
     git commit -m "[提交消息]"
     ```

<<< 如果不是[快速模式]则暂停：继续之前，询问用户是否应将[任务分支]合并到[主分支]，如果不是，继续执行步骤 8 >>>

## 6. 合并任务分支
1. 合并到[主分支]前与用户确认
2. 如果批准：
   - 检出[主分支]：  
     ```
     git checkout [主分支]
     ```
   - 合并：  
     ```
     git merge task/[任务标识符]_[任务日期和编号]
     ```
3. 通过运行以下命令确认合并成功：
   ```
   git log [任务分支]..[主分支] | cat
   ```

## 7. 删除任务分支
1. 询问用户是否应删除[任务分支]，如果不是，继续执行步骤 8
2. 删除[任务分支]：  
   ```
   git branch -d task/[任务标识符]_[任务日期和编号]
   ```

<<< 如果不是[快速模式]则暂停：继续之前，通过查看 `git branch --list | cat` 与用户确认[任务分支]是否已成功删除 >>>

## 8. 最终审查
1. 查看我们所做的一切并填写[任务文件]中的"最终审查"

<<< 如果不是[快速模式]则暂停：在我们完成之前，向用户提供最终审查 >>>

---

# 任务文件模板：
```markdown
# 上下文
任务文件名称: [任务文件名]
创建时间: [日期时间]
创建者: [用户名]
快速模式: [快速模式]

# 任务描述
[基于用户提供的[任务]的详细描述]

# 项目概述
[基于用户提供的[项目概述]的详细概述]

# 原始任务模板
[完整的未编辑的"任务文件模板"]
- 将完整的未编辑的"任务文件模板"复制并粘贴到此部分，__包括所有细节__
- 用 markdown 代码块包围它
- 在此部分底部添加"请勿删除或编辑此部分"，以便在整个过程中保持不变

# 原始执行协议
[完整的未编辑的"执行协议"部分]
- 将完整的未编辑的"执行协议"部分复制并粘贴到此部分，__包括每个执行步骤下的所有细节__
- 用 markdown 代码块包围它
- 在此部分底部添加"请勿删除或编辑此部分"，以便在整个过程中保持不变

# 任务分析
- [任务]的目的
- 已识别的问题，包括：
  - 造成的问题
  - 为什么需要解决
  - 实现细节和目标
- 其他有用的参考细节

# 主分支
[主分支]

# 任务分支
[任务分支]

# 要采取的步骤
[任务的可执行步骤列表]
- 没有任务时只写"—"

# 当前执行步骤：[当前执行步骤的编号]

# 任务进度
- 更新必须包括：
  - 必填：
    - [日期时间]
    - 成功/失败，在用户确认后
  - 可选：
    - 发现、解决方案、阻碍因素和结果
    - 所有更新必须按时间顺序记录

# 最终审查
[仅在任务完成后填写]
```

---

# 占位符定义：
[ 解释整个提示中使用的占位符 ]
- [任务]：要处理的具体任务或问题（例如，"修复缓存管理器"）
- [任务标识符]：任务的唯一、人类可读的标识符（例如，"fix-cache-manager"）
- [任务文件名]：任务文件的名称
- [任务日期和编号]：任务文件的时间戳和顺序标识符（例如，"2025-01-14_1"）
- [主分支]：进行主要开发的分支（默认："master"）
- [任务文件]：用于记录和跟踪任务进度的 Markdown 文件
- [任务分支]：实施任务更改的 Git 分支
- [日期时间]：当前日期和时间
- [日期]：当前日期
- [时间]：当前时间
- [用户名]：当前用户名
- [提交消息]：我们所做工作的简短而简明的提交消息，尽可能保持简短
- [快速模式]：我们是否处于快速模式，如果是，你会忽略"<<< 暂停 >>>"停止并做你认为最好的事情。尽可能少地询问用户问题。
- 用于填充某些占位符的命令：
   - [任务文件名]：`echo $(date +%Y-%m-%d)_$(($(find .tasks -maxdepth 1 -name "$(date +%Y-%m-%d)_*" | wc -l) + 1))`
   - [日期时间]：`echo $(date +'%Y-%m-%d_%H:%M:%S')`
   - [日期]：`echo $(date +'%Y-%m-%d')`
   - [时间]：`echo $(date +'%H:%M:%S')`
   - [用户名]：`echo $(whoami)`
</code_block_to_apply_changes_from>
